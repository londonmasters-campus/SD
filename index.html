<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>London Masters Campus - Student Verification</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<style>
:root{--dark-blue:#001f3f;--brand-red:#ff0000;--white:#ffffff;--star-color:#ffcc00;}
body{
 margin:0;font-family:'Segoe UI',sans-serif;
 background:var(--dark-blue);
 display:flex;justify-content:center;align-items:center;
 min-height:100vh;padding:10px;
}
.container{
 width:100%;max-width:450px;background:#fff;
 border-radius:20px;overflow:hidden;
 box-shadow:0 15px 35px rgba(0,0,0,.4);
}
.banner{
 padding:25px 15px;text-align:center;
 border-bottom:2px solid #f0f0f0;
}
.banner img{height:80px}
.banner h1{
 margin:15px 0 0;font-size:24px;
 background:linear-gradient(to right,var(--dark-blue) 20%,var(--brand-red) 50%,var(--dark-blue) 80%);
 background-size:200% auto;
 -webkit-background-clip:text;
 -webkit-text-fill-color:transparent;
 animation:move 3s linear infinite;
}
@keyframes move{0%{background-position:200%}100%{background-position:0%}}

.form-content{padding:25px 20px}
label{font-size:14px;font-weight:600;margin-bottom:8px;display:block}
select,input{
 width:100%;padding:14px;margin-bottom:20px;
 border:1px solid #b0bec5;border-radius:10px;font-size:16px;
}
select{min-height:70px;white-space:pre-line}

.stars{
 display:flex;flex-direction:row-reverse;justify-content:center;gap:10px;margin-bottom:25px
}
.stars input{display:none}
.stars label{font-size:35px;color:#ccc;cursor:pointer}
.stars input:checked~label,
.stars label:hover,
.stars label:hover~label{color:var(--star-color)}

button{
 width:100%;padding:16px;border:none;border-radius:10px;
 font-size:16px;font-weight:bold;cursor:pointer;position:relative
}
#verifyBtn{background:var(--brand-red);color:#fff}
#submitBtn{background:var(--dark-blue);color:#fff;display:none}
#otpBtn{background:#28a745;color:#fff}

.loader{
 border:3px solid #f3f3f3;border-top:3px solid currentColor;
 border-radius:50%;width:20px;height:20px;
 animation:spin 1s linear infinite;display:none;margin:auto
}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

#additionalFields,#otpSection,#successSection,#repeatActions{display:none}

/* AD */
#adOverlay{
 position:fixed;inset:0;background:rgba(0,0,0,.45);
 display:none;align-items:center;justify-content:center;z-index:9999
}
#adBox{position:relative;animation:zoom .4s ease}
@keyframes zoom{from{transform:scale(.6)}to{transform:scale(1)}}
#adBox img{width:90vw;max-width:400px;border-radius:20px}
#adClose{
 position:absolute;top:-12px;right:-12px;
 width:32px;height:32px;border-radius:50%;
 background:#fff;color:#000;font-weight:bold;
 display:flex;align-items:center;justify-content:center;cursor:pointer
}
</style>
</head>

<body>

<div class="container">
<div class="banner">
<img src="assets/logo.png">
<h1>London Masters Campus</h1>
</div>

<div class="form-content">

<div id="step1">
<label>Course Name</label>
<select id="course">
<option value="MDRT">Breaking Barriers for MDRT 2026
Mr. Suranjith Godagama</option>
<option value="Bathiya">Reset & Rebuild 2026
Mr. Bhathiya Arthanayaka</option>
</select>

<label>Mobile Number (Registered Only)</label>
<input id="mobile" maxlength="10" placeholder="07xxxxxxxx">

<button id="verifyBtn" onclick="verifyMobile()">
<span id="vTxt">Verify Mobile No</span>
<div class="loader" id="vLoad"></div>
</button>

<div id="repeatActions" style="margin-top:15px">
<button style="background:#001f3f;color:#fff;margin-bottom:10px" onclick="editGmail()">Edit your gmail</button>
<button style="background:#28a745;color:#fff" onclick="downloadDirect()">Download certificate</button>
</div>
</div>

<div id="additionalFields">
<label>Full Name (Certificate)</label>
<input id="fullName">

<label>Gmail Address</label>
<input id="gmail" placeholder="yourname@gmail.com">
<div style="color:red;font-size:12px;margin-top:-15px;margin-bottom:15px">
Gmail ලිපිනය පමණක් ඇතුළත් කරන්න
</div>

<label>Nearest City</label>
<input id="city">

<label>Rate the Programme</label>
<div class="stars">
<input type="radio" id="r5" name="rating" value="5"><label for="r5">★</label>
<input type="radio" id="r4" name="rating" value="4"><label for="r4">★</label>
<input type="radio" id="r3" name="rating" value="3"><label for="r3">★</label>
<input type="radio" id="r2" name="rating" value="2"><label for="r2">★</label>
<input type="radio" id="r1" name="rating" value="1"><label for="r1">★</label>
</div>

<button id="submitBtn" onclick="finalSubmit()">
<span id="sTxt">Submit & Send OTP</span>
<div class="loader" id="sLoad"></div>
</button>
</div>

<div id="otpSection">
<p style="text-align:center;font-size:15px">
ඔබගේ e-certificate download කර ගැනීම සඳහා ඔබගේ Gmail ලිපිනයට ලැබෙන OTP අංකය ඇතුළත් කරන්න
</p>
<input id="otpInput" maxlength="6" style="text-align:center;font-size:24px;letter-spacing:5px">
<button id="otpBtn" onclick="verifyOTP()">
<span id="oTxt">Verify & Download Certificate</span>
<div class="loader" id="oLoad"></div>
</button>
</div>

<div id="successSection" style="text-align:center">
<h2 style="color:green">Success!</h2>
<a id="downloadLink" target="_blank"
style="display:inline-block;padding:15px 25px;background:var(--brand-red);
color:#fff;border-radius:10px;text-decoration:none;font-weight:bold">
Download Certificate
</a>
</div>

</div>
</div>

<div id="adOverlay">
<div id="adBox">
<img src="ad_1080.webp">
<div id="adClose" onclick="closeAd()">✕</div>
</div>
</div>

<script>
const scriptUrl="https://script.google.com/macros/s/AKfycbwnusPahEzNBV3ZJOLPfk0hHmxKHe91Fy4RiEmZMJl5NqZL_uggL-bUQbHzd8jeo_LI/exec";
let repeatEmail="",repeatName="";
const isGmail=e=>e.endsWith("@gmail.com");
const showAd=()=>adOverlay.style.display="flex";
const closeAd=()=>adOverlay.style.display="none";

function verifyMobile(){
 if(mobile.value.length!=10)return alert("නිවැරදි අංකයක් ඇතුළත් කරන්න");
 vTxt.style.display="none";vLoad.style.display="block";

 fetch(`${scriptUrl}?action=verify&mobile=${mobile.value}&course=${course.value}`)
 .then(r=>r.json()).then(d=>{
   vTxt.style.display="block";vLoad.style.display="none";

   if(d.status=="new"){
     step1.style.display="none";
     additionalFields.style.display="block";
     submitBtn.style.display="block";
     showAd();
   }
   if(d.status=="already"){
     repeatEmail=d.email;
     repeatName=d.name;
     repeatActions.style.display="block";
   }
   if(d.status=="not_found") alert("ඔබ ලියාපදිංචි වී නොමැත");
 });
}

function editGmail(){
 fullName.value=repeatName;
 gmail.value=repeatEmail;
 step1.style.display="none";
 additionalFields.style.display="block";
 submitBtn.style.display="block";
}

function downloadDirect(){
 fullName.value=repeatName;
 gmail.value=repeatEmail;
 step1.style.display="none";
 otpSection.style.display="block";
 fetch(`${scriptUrl}?action=sendOtp&email=${repeatEmail}`);
}

function finalSubmit(){
 if(!isGmail(gmail.value))return alert("Gmail ලිපිනය පමණක් ඇතුළත් කරන්න");
 sTxt.style.display="none";sLoad.style.display="block";

 let p=new URLSearchParams({
 action:"submit",
 mobile:mobile.value,
 course:course.value,
 name:fullName.value,
 email:gmail.value,
 city:city.value,
 rating:document.querySelector('input[name=rating]:checked')?.value||"0"
 });

 fetch(`${scriptUrl}?${p}`)
 .then(()=>{additionalFields.style.display="none";otpSection.style.display="block"});
}

function verifyOTP(){
 oTxt.style.display="none";oLoad.style.display="block";
 let p=new URLSearchParams({
 action:"verifyOTP",
 email:gmail.value,
 otp:otpInput.value,
 course:course.value,
 name:fullName.value
 });

 fetch(`${scriptUrl}?${p}`)
 .then(r=>r.json()).then(d=>{
   if(d.status=="success"){
     confetti({particleCount:200,spread:80});
     otpSection.style.display="none";
     successSection.style.display="block";
     downloadLink.href=d.url;
   }else alert("OTP වැරදියි හෝ කල් ඉකුත් වී ඇත");
 });
}
</script>

</body>
</html>
